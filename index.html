<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Day Planner ‚Äî Gayan</title>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface2: #1a1a25;
    --border: #2a2a3a;
    --text: #e0e0e8;
    --text-dim: #888899;
    --accent: #6366f1;
    --accent-light: #818cf8;
    --green: #22c55e;
    --orange: #f59e0b;
    --red: #ef4444;
    --blue: #3b82f6;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

  /* Left Panel */
  .sidebar { width: 280px; min-width: 280px; background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow-y: auto; }
  .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
  .sidebar-header h1 { font-size: 18px; font-weight: 700; }
  .sidebar-header p { font-size: 12px; color: var(--text-dim); margin-top: 4px; }

  .year-group { border-bottom: 1px solid var(--border); }
  .year-label, .month-label, .day-item {
    padding: 8px 16px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 13px; transition: background 0.15s;
  }
  .year-label { font-weight: 700; font-size: 14px; padding: 12px 16px; background: var(--surface2); }
  .year-label:hover, .month-label:hover { background: var(--surface2); }
  .month-label { padding-left: 28px; font-weight: 600; color: var(--accent-light); }
  .day-item { padding-left: 44px; color: var(--text-dim); font-size: 12px; }
  .day-item:hover { background: var(--surface2); color: var(--text); }
  .day-item.active { background: var(--accent); color: white; border-radius: 4px; margin: 2px 8px; padding-left: 36px; }
  .day-item.today { font-weight: 700; color: var(--accent-light); }
  .day-item.has-plans::after { content: '‚Ä¢'; color: var(--green); margin-left: auto; font-size: 16px; }
  .collapse-icon { font-size: 10px; transition: transform 0.2s; }
  .collapsed .collapse-icon { transform: rotate(-90deg); }
  .collapsed .month-list, .collapsed .day-list { display: none; }

  .today-btn { margin: 12px 16px; padding: 8px; background: var(--accent); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; }
  .today-btn:hover { background: var(--accent-light); }

  /* Main Content */
  .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
  .main-header { padding: 20px 28px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .main-header h2 { font-size: 22px; font-weight: 700; }
  .main-header .date-nav { display: flex; gap: 8px; align-items: center; }
  .main-header .date-nav button { background: var(--surface2); border: 1px solid var(--border); color: var(--text); padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; }
  .main-header .date-nav button:hover { background: var(--border); }

  .day-summary { padding: 12px 28px; background: var(--surface); border-bottom: 1px solid var(--border); display: flex; gap: 20px; font-size: 12px; }
  .stat { display: flex; align-items: center; gap: 6px; }
  .stat-dot { width: 8px; height: 8px; border-radius: 50%; }
  .stat-dot.planned { background: var(--blue); }
  .stat-dot.done { background: var(--green); }
  .stat-dot.missed { background: var(--red); }
  .stat-dot.free { background: var(--border); }

  .schedule { flex: 1; overflow-y: auto; padding: 16px 28px; }
  .hour-block { display: grid; grid-template-columns: 70px 1fr 1fr; gap: 0; border-bottom: 1px solid var(--border); min-height: 60px; }
  .hour-block:hover { background: rgba(99, 102, 241, 0.03); }
  .hour-time { padding: 10px 8px; font-size: 12px; font-weight: 600; color: var(--text-dim); border-right: 1px solid var(--border); display: flex; align-items: flex-start; justify-content: center; }
  .hour-time.current-hour { color: var(--accent); }

  .hour-plan, .hour-actual { padding: 8px 12px; position: relative; }
  .hour-plan { border-right: 1px solid var(--border); }
  .column-header { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); margin-bottom: 4px; font-weight: 600; }
  .hour-plan .column-header { color: var(--blue); }
  .hour-actual .column-header { color: var(--green); }

  .hour-content { min-height: 32px; padding: 4px 6px; border-radius: 4px; font-size: 13px; line-height: 1.5; cursor: text; white-space: pre-wrap; word-break: break-word; }
  .hour-content:hover { background: var(--surface2); }
  .hour-content:focus { background: var(--surface2); outline: 1px solid var(--accent); outline-offset: 1px; }
  .hour-content:empty::before { content: attr(data-placeholder); color: var(--text-dim); opacity: 0.4; font-style: italic; }

  .hour-content .tag { display: inline-block; padding: 1px 6px; border-radius: 3px; font-size: 11px; font-weight: 600; margin-right: 4px; }
  .tag-work { background: rgba(99, 102, 241, 0.2); color: var(--accent-light); }
  .tag-health { background: rgba(34, 197, 94, 0.2); color: var(--green); }
  .tag-family { background: rgba(245, 158, 11, 0.2); color: var(--orange); }
  .tag-sales { background: rgba(239, 68, 68, 0.2); color: var(--red); }

  /* Priority markers */
  .priority-high { border-left: 3px solid var(--red); }
  .priority-med { border-left: 3px solid var(--orange); }
  .priority-low { border-left: 3px solid var(--blue); }

  /* Status indicators */
  .status-done .hour-plan { opacity: 0.5; }
  .status-done .hour-actual { background: rgba(34, 197, 94, 0.05); }

  /* Markdown rendering */
  .hour-content strong { font-weight: 700; color: var(--accent-light); }
  .hour-content em { font-style: italic; color: var(--text-dim); }
  .hour-content code { background: var(--surface2); padding: 1px 4px; border-radius: 3px; font-size: 12px; }

  /* Column headers row */
  .schedule-header { display: grid; grid-template-columns: 70px 1fr 1fr; gap: 0; border-bottom: 2px solid var(--border); padding: 8px 0; position: sticky; top: 0; background: var(--bg); z-index: 5; }
  .schedule-header div { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); font-weight: 700; text-align: center; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* Save indicator */
  .save-indicator { position: fixed; bottom: 20px; right: 20px; background: var(--green); color: #000; padding: 8px 16px; border-radius: 6px; font-size: 12px; font-weight: 600; opacity: 0; transition: opacity 0.3s; z-index: 100; }
  .save-indicator.show { opacity: 1; }

  /* Export button */
  .export-btn { background: none; border: 1px solid var(--border); color: var(--text-dim); padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
  .export-btn:hover { background: var(--surface2); color: var(--text); }
</style>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <h1>üìÖ Day Planner</h1>
    <p>Plan ‚Üí Execute ‚Üí Review</p>
  </div>
  <button class="today-btn" onclick="goToday()">‚ö° Today</button>
  <div id="sidebar-nav"></div>
</div>

<div class="main">
  <div class="main-header">
    <div class="date-nav">
      <button onclick="prevDay()">‚Üê</button>
      <h2 id="current-date-title"></h2>
      <button onclick="nextDay()">‚Üí</button>
    </div>
    <div style="display:flex;gap:8px;">
      <button class="export-btn" onclick="exportDay()">üìã Export MD</button>
      <button class="export-btn" onclick="exportJSON()">üíæ Export Data</button>
      <button class="export-btn" onclick="importJSON()">üì• Import</button>
    </div>
  </div>

  <div class="day-summary" id="day-summary"></div>

  <div class="schedule">
    <div class="schedule-header">
      <div>Time</div>
      <div style="color:var(--blue)">üìã Plan</div>
      <div style="color:var(--green)">‚úÖ Actual</div>
    </div>
    <div id="schedule-body"></div>
  </div>
</div>

<div class="save-indicator" id="save-indicator">‚úÖ Saved</div>
<input type="file" id="import-input" accept=".json" style="display:none">

<script>
// State
let currentDate = new Date();
let data = {};
const STORAGE_KEY = 'dayplanner_data';

// Load data
function loadData() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) data = JSON.parse(saved);
  } catch(e) { data = {}; }
}

function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  const el = document.getElementById('save-indicator');
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 1500);
}

function dateKey(d) {
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

function getDayData(key) {
  if (!data[key]) data[key] = { hours: {} };
  return data[key];
}

function setHourData(key, hour, field, value) {
  const day = getDayData(key);
  if (!day.hours[hour]) day.hours[hour] = { plan: '', actual: '' };
  day.hours[hour][field] = value;
  saveData();
}

// Render sidebar
function renderSidebar() {
  const nav = document.getElementById('sidebar-nav');
  const today = new Date();
  const currentKey = dateKey(currentDate);

  // Show current year and surrounding months
  const year = currentDate.getFullYear();
  const months = [];
  for (let m = 0; m < 12; m++) {
    months.push(m);
  }

  let html = `<div class="year-group" id="year-${year}">
    <div class="year-label" onclick="toggleCollapse('year-${year}')">
      <span class="collapse-icon">‚ñº</span> ${year}
    </div>
    <div class="month-list">`;

  const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];

  months.forEach(m => {
    const monthId = `month-${year}-${m}`;
    const isCurrentMonth = (m === currentDate.getMonth());
    const collapsed = !isCurrentMonth ? 'collapsed' : '';

    html += `<div class="month-group ${collapsed}" id="${monthId}">
      <div class="month-label" onclick="toggleCollapse('${monthId}')">
        <span class="collapse-icon">‚ñº</span> ${monthNames[m]}
      </div>
      <div class="day-list">`;

    const daysInMonth = new Date(year, m + 1, 0).getDate();
    const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

    for (let d = 1; d <= daysInMonth; d++) {
      const dt = new Date(year, m, d);
      const key = dateKey(dt);
      const isToday = key === dateKey(today);
      const isActive = key === currentKey;
      const hasPlans = data[key] && Object.values(data[key].hours || {}).some(h => h.plan || h.actual);

      let classes = 'day-item';
      if (isActive) classes += ' active';
      if (isToday) classes += ' today';
      if (hasPlans) classes += ' has-plans';

      html += `<div class="${classes}" onclick="goToDate('${key}')">
        ${dayNames[dt.getDay()]} ${d}
      </div>`;
    }

    html += `</div></div>`;
  });

  html += `</div></div>`;
  nav.innerHTML = html;
}

function toggleCollapse(id) {
  document.getElementById(id).classList.toggle('collapsed');
}

// Render schedule
function renderSchedule() {
  const key = dateKey(currentDate);
  const dayData = getDayData(key);
  const today = new Date();
  const isToday = dateKey(today) === key;
  const currentHour = today.getHours();

  // Title
  const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  document.getElementById('current-date-title').textContent =
    `${days[currentDate.getDay()]}, ${currentDate.getDate()} ${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

  // Schedule body
  const body = document.getElementById('schedule-body');
  let html = '';

  for (let h = 5; h <= 23; h++) {
    const hourStr = `${String(h).padStart(2,'0')}:00`;
    const hourData = dayData.hours[h] || { plan: '', actual: '' };
    const isCurrentHour = isToday && h === currentHour;
    const hasPlan = hourData.plan && hourData.plan.trim();
    const hasActual = hourData.actual && hourData.actual.trim();

    let blockClass = 'hour-block';
    if (hasActual) blockClass += ' status-done';

    html += `<div class="${blockClass}" id="hour-${h}">
      <div class="hour-time ${isCurrentHour ? 'current-hour' : ''}">${hourStr}</div>
      <div class="hour-plan">
        <div class="hour-content" contenteditable="true"
          data-placeholder="Plan..."
          data-hour="${h}" data-field="plan"
          oninput="onEdit(this)"
          onblur="onBlur(this)">${escapeHtml(hourData.plan)}</div>
      </div>
      <div class="hour-actual">
        <div class="hour-content" contenteditable="true"
          data-placeholder="What actually happened..."
          data-hour="${h}" data-field="actual"
          oninput="onEdit(this)"
          onblur="onBlur(this)">${escapeHtml(hourData.actual)}</div>
      </div>
    </div>`;
  }

  body.innerHTML = html;

  // Scroll to current hour
  if (isToday) {
    setTimeout(() => {
      const el = document.getElementById(`hour-${currentHour}`);
      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 100);
  }

  // Update summary
  updateSummary(key);
}

function updateSummary(key) {
  const dayData = getDayData(key);
  let planned = 0, done = 0, missed = 0, free = 0;

  for (let h = 5; h <= 23; h++) {
    const hourData = dayData.hours[h] || {};
    const hasPlan = hourData.plan && hourData.plan.trim();
    const hasActual = hourData.actual && hourData.actual.trim();

    if (hasPlan && hasActual) done++;
    else if (hasPlan && !hasActual) {
      const now = new Date();
      if (dateKey(now) === key && h <= now.getHours()) missed++;
      else planned++;
    }
    else free++;
  }

  document.getElementById('day-summary').innerHTML = `
    <div class="stat"><div class="stat-dot planned"></div> Planned: ${planned}</div>
    <div class="stat"><div class="stat-dot done"></div> Done: ${done}</div>
    <div class="stat"><div class="stat-dot missed"></div> Missed: ${missed}</div>
    <div class="stat"><div class="stat-dot free"></div> Free: ${free}</div>
  `;
}

function escapeHtml(text) {
  if (!text) return '';
  return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

let saveTimeout;
function onEdit(el) {
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(() => {
    const hour = parseInt(el.dataset.hour);
    const field = el.dataset.field;
    const key = dateKey(currentDate);
    setHourData(key, hour, field, el.textContent);
    updateSummary(key);
  }, 500);
}

function onBlur(el) {
  const hour = parseInt(el.dataset.hour);
  const field = el.dataset.field;
  const key = dateKey(currentDate);
  setHourData(key, hour, field, el.textContent);
  updateSummary(key);
}

// Navigation
function goToday() {
  currentDate = new Date();
  renderSidebar();
  renderSchedule();
}

function goToDate(key) {
  const parts = key.split('-');
  currentDate = new Date(parseInt(parts[0]), parseInt(parts[1])-1, parseInt(parts[2]));
  renderSidebar();
  renderSchedule();
}

function prevDay() {
  currentDate.setDate(currentDate.getDate() - 1);
  renderSidebar();
  renderSchedule();
}

function nextDay() {
  currentDate.setDate(currentDate.getDate() + 1);
  renderSidebar();
  renderSchedule();
}

// Export
function exportDay() {
  const key = dateKey(currentDate);
  const dayData = getDayData(key);
  let md = `# ${key}\n\n| Time | Plan | Actual |\n|------|------|--------|\n`;

  for (let h = 5; h <= 23; h++) {
    const hourData = dayData.hours[h] || {};
    const plan = (hourData.plan || '-').replace(/\n/g, ' ');
    const actual = (hourData.actual || '-').replace(/\n/g, ' ');
    md += `| ${String(h).padStart(2,'0')}:00 | ${plan} | ${actual} |\n`;
  }

  navigator.clipboard.writeText(md).then(() => {
    const el = document.getElementById('save-indicator');
    el.textContent = 'üìã Copied to clipboard!';
    el.classList.add('show');
    setTimeout(() => { el.classList.remove('show'); el.textContent = '‚úÖ Saved'; }, 2000);
  });
}

function exportJSON() {
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `dayplanner-${dateKey(new Date())}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function importJSON() {
  document.getElementById('import-input').click();
}

document.getElementById('import-input').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    try {
      const imported = JSON.parse(ev.target.result);
      Object.assign(data, imported);
      saveData();
      renderSidebar();
      renderSchedule();
    } catch(err) { alert('Invalid JSON file'); }
  };
  reader.readAsText(file);
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if (e.target.contentEditable === 'true') return;
  if (e.key === 'ArrowLeft') prevDay();
  if (e.key === 'ArrowRight') nextDay();
  if (e.key === 't') goToday();
});

// API for programmatic updates
window.plannerAPI = {
  setHour: (dateStr, hour, plan, actual) => {
    if (plan !== undefined) setHourData(dateStr, hour, 'plan', plan);
    if (actual !== undefined) setHourData(dateStr, hour, 'actual', actual);
    if (dateKey(currentDate) === dateStr) renderSchedule();
  },
  getDay: (dateStr) => getDayData(dateStr),
  getAllData: () => data
};

// Init
loadData();

// Pre-populate today if empty
const todayKey = dateKey(new Date());
const todayData = getDayData(todayKey);
const hasAnyPlan = Object.values(todayData.hours).some(h => h.plan);

if (!hasAnyPlan) {
  // Gayan's default schedule for today (Tue Feb 25)
  const defaults = {
    7: { plan: 'üèãÔ∏è Gym ‚Äî cardiac health, non-negotiable', actual: '' },
    8: { plan: 'üöø Get ready + breakfast', actual: '' },
    9: { plan: 'üöó Wash car', actual: '' },
    10: { plan: 'üì∏ Pick up printed photos', actual: '' },
    11: { plan: 'üéÅ Get gift for Andy', actual: '' },
    12: { plan: 'üçΩÔ∏è Lunch', actual: '' },
    13: { plan: 'üíº Day job', actual: '' },
    14: { plan: 'üíº Day job', actual: '' },
    15: { plan: 'üíº Day job', actual: '' },
    16: { plan: 'üíº Day job', actual: '' },
    17: { plan: 'üíº Day job', actual: '' },
    18: { plan: 'üìñ Study time with Rylie ‚Äî P3 weighted assessments', actual: '' },
    19: { plan: 'üçΩÔ∏è Dinner + family time', actual: '' },
    20: { plan: 'üìû Ventaz Sales ‚Äî 3hr block (Hour 1: 15 outreaches)', actual: '' },
    21: { plan: 'üìû Ventaz Sales ‚Äî (Hour 2: Follow-ups + demos)', actual: '' },
    22: { plan: 'üìû Ventaz Sales ‚Äî (Hour 3: Close + update CRM)', actual: '' },
    23: { plan: 'üåô Wind down + plan tomorrow', actual: '' },
  };

  Object.entries(defaults).forEach(([h, d]) => {
    if (!todayData.hours[h]) todayData.hours[h] = d;
  });
  saveData();
}

renderSidebar();
renderSchedule();
</script>
</body>
</html>
